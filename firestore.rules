rules_version = '2';
service cloud.firestore {
  match /databases/play/documents {
    // Users collection
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      // Allow clients to read instructor profiles
      allow read: if request.auth != null && resource.data.isInstructor == true;
    }
    
    // Locations collection
    match /locations/{locationId} {
      allow read, write: if request.auth != null;
    }
    
    // Bookable Sessions collection
    match /bookable_sessions/{sessionId} {
      allow read, write: if request.auth != null;
    }
    
    // Schedules collection
    match /schedules/{scheduleId} {
      allow read, write: if request.auth != null;
    }
    
    // Session Types collection
    match /session_types/{typeId} {
      allow read, write: if request.auth != null;
    }
    
    // Bookings collection
    match /bookings/{bookingId} {
      allow read, write: if request.auth != null;
    }
    
    // Reviews collection
    match /reviews/{reviewId} {
      allow read, write: if request.auth != null;
    }
    
    // Notifications collection
    match /notifications/{notificationId} {
      allow read, write: if request.auth != null;
    }
    
    // Mail collection for email notifications
    match /mail/{mailId} {
      allow create: if request.auth != null;
    }
    
    // Instructors collection
    match /instructors/{instructorId} {
      allow read, write: if request.auth != null;
    }
    
    // Allow read/write access to any other collections (for existing apps)
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}