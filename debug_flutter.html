<!DOCTYPE html>
<html>
<head>
    <title>Flutter Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; background: #e6ffe6; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .info { color: blue; background: #e6f3ff; padding: 10px; margin: 10px 0; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Flutter Debug Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Test 1: Check if _flutter exists
        log('Testing Flutter loader availability...', 'info');
        
        if (typeof _flutter === 'undefined') {
            log('‚ùå _flutter is not defined - flutter.js not loaded', 'error');
        } else {
            log('‚úÖ _flutter is defined', 'success');
            
            if (_flutter.loader) {
                log('‚úÖ _flutter.loader exists', 'success');
                
                // Test the actual initialization
                try {
                    log('üîÑ Attempting Flutter initialization...', 'info');
                    
                    _flutter.loader.loadEntrypoint({
                        serviceWorker: {
                            serviceWorkerVersion: null,
                        },
                        onEntrypointLoaded: function(engineInitializer) {
                            log('‚úÖ Entrypoint loaded successfully', 'success');
                            
                            const engineConfig = { renderer: 'auto' };
                            
                            engineInitializer.initializeEngine(engineConfig).then(function(appRunner) {
                                log('‚úÖ Engine initialized successfully', 'success');
                                
                                try {
                                    appRunner.runApp();
                                    log('‚úÖ App started successfully!', 'success');
                                } catch (runError) {
                                    log(`‚ùå App run failed: ${runError.message}`, 'error');
                                    log(`Stack: ${runError.stack}`, 'error');
                                }
                            }).catch(function(engineError) {
                                log(`‚ùå Engine initialization failed: ${engineError.message}`, 'error');
                                log(`Stack: ${engineError.stack}`, 'error');
                            });
                        }
                    });
                } catch (loadError) {
                    log(`‚ùå LoadEntrypoint failed: ${loadError.message}`, 'error');
                    log(`Stack: ${loadError.stack}`, 'error');
                }
            } else {
                log('‚ùå _flutter.loader is not available', 'error');
            }
        }
        
        // Test 2: Check for common issues
        log('Checking for common issues...', 'info');
        
        // Check if main.dart.js is accessible
        fetch('main.dart.js')
            .then(response => {
                if (response.ok) {
                    log('‚úÖ main.dart.js is accessible', 'success');
                } else {
                    log(`‚ùå main.dart.js returned ${response.status}`, 'error');
                }
            })
            .catch(error => {
                log(`‚ùå main.dart.js fetch failed: ${error.message}`, 'error');
            });
        
        // Check if flutter.js is accessible
        fetch('flutter.js')
            .then(response => {
                if (response.ok) {
                    log('‚úÖ flutter.js is accessible', 'success');
                } else {
                    log(`‚ùå flutter.js returned ${response.status}`, 'error');
                }
            })
            .catch(error => {
                log(`‚ùå flutter.js fetch failed: ${error.message}`, 'error');
            });
        
        // Capture console errors
        const originalError = console.error;
        console.error = function(...args) {
            log(`Console Error: ${args.join(' ')}`, 'error');
            originalError.apply(console, args);
        };
        
        // Wait a bit then check if Flutter loaded
        setTimeout(() => {
            if (typeof _flutter === 'undefined') {
                log('‚ùå _flutter still undefined after 5 seconds - flutter.js loading issue', 'error');
            }
        }, 5000);
    </script>
    
    <!-- Load flutter.js to test -->
    <script src="http://localhost:8080/flutter.js" defer></script>
</body>
</html>

